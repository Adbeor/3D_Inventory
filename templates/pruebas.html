<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario de Filamentos</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .floating-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 10px;
            z-index: 100;
            display: none; /* Oculta inicialmente */
        }
        .floating-menu a {
            display: block;
            padding: 5px 0;
            color: #007bff;
            text-decoration: none;
        }
        .floating-menu a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Inventario de Filamentos</h1>
    <a href="{{ url_for('add_filamento') }}">Agregar Filamento</a>
    <br>
    <a href="{{ url_for('add_marca') }}">Agregar Marca</a>
    <br>
    <a href="{{ url_for('add_tipo') }}">Agregar Tipo</a>
    <br>
    <a href="{{ url_for('add_color') }}">Agregar Color</a>
    <br>
    <a href="{{ url_for('generate_qr_pdf') }}">Generar PDF con QRs</a>

    <h2>Lista de Filamentos</h2>
    <table>
        <thead>
            <tr>
                <th>Código Único</th>
                <th>Marca</th>
                <th>Tipo</th>
                <th>Peso Spool</th>
                <th>Peso Actual</th>
                <th>Descuento Peso</th>
                <th>Fecha de Apertura</th>
                <th>Días Transcurridos</th>
                <th>Estado</th>
                <th>Color</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for filamento in filamentos %}
            <tr>
                <td>{{ filamento.codigo_unico }}</td>
                <td>{{ filamento.marca.nombre }}</td>
                <td>{{ filamento.tipo.nombre }}</td>
                <td>{{ filamento.peso_spool }} g</td>
                <td>{{ filamento.peso_actual }} g</td>
                <td>{{ filamento.peso_actual - filamento.peso_spool }} g</td>
                <td>{{ filamento.fecha_apertura }}</td>
                <td>{{ (fecha_hoy - filamento.fecha_apertura).days }}</td>
                <td>{{ filamento.estado }}</td>
                <td style="background-color: {{ filamento.color.hex_color }}; color: black;">{{ filamento.color.nombre }}</td>
                <td>
                    <button class="job-button">JOB</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="floating-menu" id="floatingMenu">
        <a href="#">Opción 1</a>
        <a href="#">Opción 2</a>
        <a href="#">Opción 3</a>
    </div>

    <script>
        const jobButtons = document.querySelectorAll('.job-button');
        const floatingMenu = document.getElementById('floatingMenu');
        let currentButton = null;

        jobButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const rect = button.getBoundingClientRect();
                floatingMenu.style.top = `${rect.bottom + window.scrollY}px`;
                floatingMenu.style.left = `${rect.left + window.scrollX}px`;
                floatingMenu.style.display = 'block';
                currentButton = button;
            });
        });

        document.addEventListener('click', (event) => {
            if (!floatingMenu.contains(event.target) && !jobButtons.includes(event.target)) {
                floatingMenu.style.display = 'none';
                currentButton = null;
            }
        });
    </script>
</body>
</html>
